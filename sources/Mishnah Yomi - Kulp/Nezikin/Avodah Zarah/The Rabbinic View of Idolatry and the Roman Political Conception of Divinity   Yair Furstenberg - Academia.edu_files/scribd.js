(function(){this.StatsListener=function(){function e(){this.listenToFocusEvents(window)}return e.prototype.doc=null,e.prototype.attachment_id=null,e.prototype.docLoaded=!1,e.prototype.hasFocus=!0,e.prototype.pages={},e.prototype.lastTime=null,e.prototype.lastPage=null,e.prototype.lastSubmit=null,e.prototype.viewThreshold=999,e.prototype.submitThreshold=59999,e.prototype.standbyThreshold=36e5,e.prototype.currentPage=0,e.prototype.page_count=null,e.prototype.open_graph=[],e.prototype.openGraphSubmitted=function(e){return this.open_graph.push(e),this},e.prototype.register=function(e,t){var n,r;t==null&&(t=!1);if(e<0)return;return e>0&&(this.currentPage=e),r=(new Date).valueOf(),this.lastSubmit==null&&(this.lastSubmit=r),this.lastPage!=null&&(n=r-this.lastTime,_.has(this.pages,this.lastPage)||(this.pages[this.lastPage]=0),this.viewThreshold<n&&n<this.standbyThreshold&&(this.pages[this.lastPage]+=n)),(t||r-this.lastSubmit>this.submitThreshold)&&this.submit(),this.lastTime=r,this.lastPage=e},e.prototype.submit=function(){var e;if(this.doc==null)return;if(this.attachment_id==null)return;return e={auvid:$auvid,request_id:$request_id,attachment_id:this.attachment_id,pages:this.pages,page_count:this.page_count,open_graph:this.open_graph},this.lastSubmit=(new Date).valueOf(),this.pages={},this.open_graph=[]},e.prototype.docReady=function(){if(this.docLoaded)return;return this.docLoaded=!0,this.pages={},this.page_count=this.doc.api.getPageCount(),this.register(1)},e.prototype.pageChanged=function(){if(this.doc.api==null)return;return this.register(this.doc.api.getPage())},e.prototype.viewModeChanged=function(){},e.prototype.zoomChanged=function(){},e.prototype.docClosed=function(){if(!this.docLoaded)return;this.docLoaded=!1,this.register(0,!0),this.doc=null,this.attachment_id=null,this.lastSubmit=null,this.lastPage=null,this.currentPage=0},e.prototype.focusLost=function(){if(!this.hasFocus)return;return this.hasFocus=!1,this.register(0)},e.prototype.focusGained=function(){if(this.hasFocus)return;this.hasFocus=!0;if(this.doc==null)return;return this.pageChanged()},e.prototype.setAttachmentId=function(e){return this.attachment_id=e},e.prototype.watchScribdDocument=function(e){var t=this;return e.addEventListener("docReady",function(){return t.docReady()}),e.addEventListener("pageChanged",function(){return t.pageChanged()}),e.addEventListener("viewModeChanged",function(){return t.viewModeChanged()}),e.addEventListener("zoomChanged",function(){return t.zoomChanged()}),this.doc=e},e.prototype.listenToFocusEvents=function(e){var t=this;return $h.windowAddEventListener("focus",function(){return t.focusGained()}),$h.windowAddEventListener("blur",function(){return t.focusLost()}),$h.windowAddEventListener("unload",function(){return t.docClosed()})},e}()}).call(this);var AttachmentSeenController=BaseController.inherit({init_behaviors:function(){var e=this,t=!1,n=!1,r=!1;typeof e.options.move_viewers!="undefined"&&(t=e.options.move_viewers),$("#document_viewers_more").click(function(e){var i=this,s=$(".document_viewer.hidden");if(t){var o=$("#document_viewers_box");r||(s.appendTo(o),s.show(),r=!0),n?(o.hide(),n=!1):(o.fadeIn("fast"),n=!0)}else $(this).hide(),s.fadeIn();e.preventDefault()})}}),ScribdDocController=BaseController.inherit({init_behaviors:function(){this.init_vars(),this.init_objs()},init_vars:function(){var e=this;e.current_page=1,e.total_pages=1,e.current_zoom=1,e.doc_visible=!1,typeof e.layers=="undefined"&&(e.layers=new Array)},init_objs:function(){var e=this;e.top_bar=$("#document_buttons"),e.prev_page=$("#previous"),e.next_page=$("#next"),e.highlight=$("#highlight")},add_layer:function(e){var t=this;typeof t.layers=="undefined"&&(t.layers=new Array),t.layers.push(e),e.scribd=t},show:function(e){var t=this;t.attachment_height=e.attachment_height,t.init_highlight_position=e.highlight,t.show_scribd_document(e.attachment_id,e.scribd_id,e.scribd_key)},show_scribd_document:function(e,t,n){if($.browser.msie&&parseInt($.browser.version,10)===7)$("#loading").hide();else{$a.log("show_scribd_document");var r=this;r.attachment_id=e;var i=$("#"+r.options.scribd_element);$a.log(i),r.scribd_doc=scribd.Document.getDoc(t,n);var s=new StatsListener;s.watchScribdDocument(r.scribd_doc),s.setAttachmentId(r.attachment_id);if(typeof r.scribd_doc=="object"){var o=2;r.scribd_doc.addParam("jsapi_version",o),r.set_scribd_size(),r.scribd_doc.addParam("disable_related_docs",!0),r.scribd_doc.addParam("disable_resume_reading",!0),r.scribd_doc.addParam("hide_disabled_buttons",!0),r.scribd_doc.addEventListener("docReady",function(){r.onDocReady()}),r.scribd_page_changed_listener(),r.scribd_zoom_changed_listener(),r.scribd_doc.seamless(r.options.scribd_element)}typeof $current_user!="undefined"&&$.post("/ac_atvw",{a:r.attachment_id,_public_secret:$current_user.public_secret})}},onDocReady:function(){$("#loading").hide();var e=this,t=e.options.document_type=="cv"?"1.07":"1.42";e.scribd_doc.api.setZoom(t)},set_scribd_size:function(e,t){var n=this;if(n.options.quick_view=="true"){var r=$("#quick_view");n.doc_height=r.height(),n.doc_width=r.width()}typeof n.options.att_height!="undefined"?n.scribd_doc.addParam("height",100):n.scribd_doc.addParam("height",n.doc_height),n.scribd_doc.addParam("width",n.doc_width)},is_html5_embed:function(){var e=this,t=$("#scridb_flash_"+e.attachment_id+" iframe").attr("src");return typeof t=="undefined"?!1:!0},scribd_page_changed_listener:function(e){var t=this;t.scribd_doc.addEventListener("pageChanged",function(){t.update_page_number(),t.position_changed()})},update_page_number:function(){var e=this;e.current_page=parseInt(e.scribd_doc.api.getPage(),10),e.current_page==-1&&(e.current_page=1),e.current_page_label.html(e.current_page+" / "+e.total_pages)},scribd_zoom_changed_listener:function(e){var t=this;t.scribd_doc.addEventListener("zoomChanged",function(){t.current_zoom=t.scribd_doc.api.getZoom(),t.position_changed()})},position_changed:function(e){var t=this;$.each(t.layers,function(e,t){t.position_updated()})},goto_zoom_level:function(e){var t=this;t.scribd_doc.api.setZoom(e)},goto_page_number:function(e){var t=this;t.set_opacity(e,t.scribd_doc.api.getPageCount()),t.scribd_doc.api.setPage(e)},set_opacity:function(e,t){var n=this;e==1?n.prev_page.css({opacity:".3"}):n.prev_page.css({opacity:"1"}),e==t?n.next_page.css({opacity:".3"}):n.next_page.css({opacity:"1"})},highlight_position:function(e){var t=this,n=.3*(t.doc_height-42)+35;t.highlight.css("top",n);var r=t.page_from_scribd_page_slider_percent(e,30);t.scribd_doc.api.setVerticalScroll(r),t.highlight.fadeIn()},page_from_scribd_page_slider_percent:function(e,t){var n=this,r=(n.doc_height-76)/n.current_zoom,i=t/100*r+5,s=i/n.attachment_height,o=e-s;return o}});